'use babel';
/* @flow */

/*
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the license found in the LICENSE file in
 * the root directory of this source tree.
 */

var FileDialogComponent = require('../lib/FileDialogComponent');

var _require = require('atom');

var File = _require.File;
var Directory = _require.Directory;

var React = require('react-for-atom');

describe('FileDialogComponent', function () {
  // We use `renderComponent` in `beforeEach` to return the component so the test
  // methods have a chance to modify the default props.
  var renderComponent;
  var props;
  var hostEl;

  beforeEach(function () {
    hostEl = document.createElement('div');
    renderComponent = function () {
      return React.render(React.createElement(FileDialogComponent, props), hostEl);
    };

    props = {
      rootDirectory: new Directory('/root/'),
      message: React.createElement(
        'div',
        null,
        'message'
      ),
      onConfirm: function onConfirm() {},
      onClose: function onClose() {}
    };
  });

  afterEach(function () {
    React.unmountComponentAtNode(hostEl);
    hostEl = null;
  });

  describe('in the root', function () {
    it('relativizes a file path', function () {
      props.initialEntry = new File('/root/file.txt');
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getText()).toBe('file.txt');
    });

    it('relativizes a folder path', function () {
      props.initialEntry = new Directory('/root/dir');
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getText()).toBe('dir/');
    });

    it('selects a file basename with an extension', function () {
      props.initialEntry = new File('/root/file.txt');
      props.shouldSelectBasename = true;
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getSelectedText()).toBe('file');
    });

    it('selects a file basename without an extension', function () {
      props.initialEntry = new File('/root/file');
      props.shouldSelectBasename = true;
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getSelectedText()).toBe('file');
    });

    it('selects a folder basename', function () {
      props.initialEntry = new Directory('/root/dir');
      props.shouldSelectBasename = true;
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getSelectedText()).toBe('dir');
    });
  });

  describe('in a subdirectory', function () {
    it('relativizes a file path', function () {
      props.initialEntry = new File('/root/subdir/file.txt');
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getText()).toBe('subdir/file.txt');
    });

    it('relativizes a folder path', function () {
      props.initialEntry = new Directory('/root/subdir/dir');
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getText()).toBe('subdir/dir/');
    });

    it('selects a file basename with an extension', function () {
      props.initialEntry = new File('/root/subdir/file.txt');
      props.shouldSelectBasename = true;
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getSelectedText()).toBe('file');
    });

    it('selects a file basename without an extension', function () {
      props.initialEntry = new File('/root/subdir/file');
      props.shouldSelectBasename = true;
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getSelectedText()).toBe('file');
    });

    it('selects a folder basename', function () {
      props.initialEntry = new Directory('/root/subdir/dir');
      props.shouldSelectBasename = true;
      var component = renderComponent();
      var textEditor = component.refs['entryPath'].getTextEditor();

      expect(textEditor.getSelectedText()).toBe('dir');
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdqb25lcy8uYXRvbS9wYWNrYWdlcy9udWNsaWRlLWZpbGUtdHJlZS9zcGVjL0ZpbGVEaWFsb2dDb21wb25lbnQtc3BlYy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxXQUFXLENBQUM7Ozs7Ozs7Ozs7O0FBV1osSUFBSSxtQkFBbUIsR0FBRyxPQUFPLENBQUMsNEJBQTRCLENBQUMsQ0FBQzs7ZUFDeEMsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7SUFBbEMsSUFBSSxZQUFKLElBQUk7SUFBRSxTQUFTLFlBQVQsU0FBUzs7QUFDcEIsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7O0FBRXRDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxZQUFNOzs7QUFHcEMsTUFBSSxlQUErQyxDQUFDO0FBQ3BELE1BQUksS0FBSyxDQUFDO0FBQ1YsTUFBSSxNQUFNLENBQUM7O0FBRVgsWUFBVSxDQUFDLFlBQU07QUFDZixVQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN2QyxtQkFBZSxHQUFHLFlBQU07QUFDdEIsYUFBTyxLQUFLLENBQUMsTUFBTSxDQUNmLG9CQUFDLG1CQUFtQixFQUFLLEtBQUssQ0FBSSxFQUNsQyxNQUFNLENBQUMsQ0FBQztLQUNiLENBQUM7O0FBRUYsU0FBSyxHQUFHO0FBQ04sbUJBQWEsRUFBRSxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUM7QUFDdEMsYUFBTyxFQUFFOzs7O09BQWtCO0FBQzNCLGVBQVMsRUFBRSxxQkFBTSxFQUFFO0FBQ25CLGFBQU8sRUFBRSxtQkFBTSxFQUFFO0tBQ2xCLENBQUM7R0FDSCxDQUFDLENBQUM7O0FBRUgsV0FBUyxDQUFDLFlBQU07QUFDZCxTQUFLLENBQUMsc0JBQXNCLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDckMsVUFBTSxHQUFHLElBQUksQ0FBQztHQUNmLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsYUFBYSxFQUFF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LENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQzs7QUFFN0QsWUFBTSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUNuRCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDJCQUEyQixFQUFFLFlBQU07QUFDcEMsV0FBSyxDQUFDLFlBQVksR0FBRyxJQUFJLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ3ZELFdBQUssQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUM7QUFDbEMsVUFBSSxTQUFTLEdBQUcsZUFBZSxFQUFFLENBQUM7QUFDbEMsVUFBSSxVQUFVLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQzs7QUFFN0QsWUFBTSxDQUFDLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUNsRCxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoiL1VzZXJzL2FuZHJld2pvbmVzLy5hdG9tL3BhY2thZ2VzL251Y2xpZGUtZmlsZS10cmVlL3NwZWMvRmlsZURpYWxvZ0NvbXBvbmVudC1zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCc7XG4vKiBAZmxvdyAqL1xuXG4vKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIGxpY2Vuc2UgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpblxuICogdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxudmFyIEZpbGVEaWFsb2dDb21wb25lbnQgPSByZXF1aXJlKCcuLi9saWIvRmlsZURpYWxvZ0NvbXBvbmVudCcpO1xudmFyIHtGaWxlLCBEaXJlY3Rvcnl9ID0gcmVxdWlyZSgnYXRvbScpO1xudmFyIFJlYWN0ID0gcmVxdWlyZSgncmVhY3QtZm9yLWF0b20nKTtcblxuZGVzY3JpYmUoJ0ZpbGVEaWFsb2dDb21wb25lbnQnLCAoKSA9PiB7XG4gIC8vIFdlIHVzZSBgcmVuZGVyQ29tcG9uZW50YCBpbiBgYmVmb3JlRWFjaGAgdG8gcmV0dXJuIHRoZSBjb21wb25lbnQgc28gdGhlIHRlc3RcbiAgLy8gbWV0aG9kcyBoYXZlIGEgY2hhbmNlIHRvIG1vZGlmeSB0aGUgZGVmYXVsdCBwcm9wcy5cbiAgdmFyIHJlbmRlckNvbXBvbmVudDogKHByb3BzOiBhbnkpID0+IFJlYWN0Q29tcG9uZW50O1xuICB2YXIgcHJvcHM7XG4gIHZhciBob3N0RWw7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgaG9zdEVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcmVuZGVyQ29tcG9uZW50ID0gKCkgPT4ge1xuICAgICAgcmV0dXJuIFJlYWN0LnJlbmRlcihcbiAgICAgICAgICA8RmlsZURpYWxvZ0NvbXBvbmVudCB7Li4ucHJvcHN9IC8+LFxuICAgICAgICAgIGhvc3RFbCk7XG4gICAgfTtcblxuICAgIHByb3BzID0ge1xuICAgICAgcm9vdERpcmVjdG9yeTogbmV3IERpcmVjdG9yeSgnL3Jvb3QvJyksXG4gICAgICBtZXNzYWdlOiA8ZGl2Pm1lc3NhZ2U8L2Rpdj4sXG4gICAgICBvbkNvbmZpcm06ICgpID0+IHt9LFxuICAgICAgb25DbG9zZTogKCkgPT4ge30sXG4gICAgfTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBSZWFjdC51bm1vdW50Q29tcG9uZW50QXROb2RlKGhvc3RFbCk7XG4gICAgaG9zdEVsID0gbnVsbDtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2luIHRoZSByb290JywgKCkgPT4ge1xuICAgIGl0KCdyZWxhdGl2aXplcyBhIGZpbGUgcGF0aCcsICgpID0+IHtcbiAgICAgIHByb3BzLmluaXRpYWxFbnRyeSA9IG5ldyBGaWxlKCcvcm9vdC9maWxlLnR4dCcpO1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgdmFyIHRleHRFZGl0b3IgPSBjb21wb25lbnQucmVmc1snZW50cnlQYXRoJ10uZ2V0VGV4dEVkaXRvcigpO1xuXG4gICAgICBleHBlY3QodGV4dEVkaXRvci5nZXRUZXh0KCkpLnRvQmUoJ2ZpbGUudHh0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgncmVsYXRpdml6ZXMgYSBmb2xkZXIgcGF0aCcsICgpID0+IHtcbiAgICAgIHByb3BzLmluaXRpYWxFbnRyeSA9IG5ldyBEaXJlY3RvcnkoJy9yb290L2RpcicpO1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgdmFyIHRleHRFZGl0b3IgPSBjb21wb25lbnQucmVmc1snZW50cnlQYXRoJ10uZ2V0VGV4dEVkaXRvcigpO1xuXG4gICAgICBleHBlY3QodGV4dEVkaXRvci5nZXRUZXh0KCkpLnRvQmUoJ2Rpci8nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzZWxlY3RzIGEgZmlsZSBiYXNlbmFtZSB3aXRoIGFuIGV4dGVuc2lvbicsICgpID0+IHtcbiAgICAgIHByb3BzLmluaXRpYWxFbnRyeSA9IG5ldyBGaWxlKCcvcm9vdC9maWxlLnR4dCcpO1xuICAgICAgcHJvcHMuc2hvdWxkU2VsZWN0QmFzZW5hbWUgPSB0cnVlO1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgdmFyIHRleHRFZGl0b3IgPSBjb21wb25lbnQucmVmc1snZW50cnlQYXRoJ10uZ2V0VGV4dEVkaXRvcigpO1xuXG4gICAgICBleHBlY3QodGV4dEVkaXRvci5nZXRTZWxlY3RlZFRleHQoKSkudG9CZSgnZmlsZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3NlbGVjdHMgYSBmaWxlIGJhc2VuYW1lIHdpdGhvdXQgYW4gZXh0ZW5zaW9uJywgKCkgPT4ge1xuICAgICAgcHJvcHMuaW5pdGlhbEVudHJ5ID0gbmV3IEZpbGUoJy9yb290L2ZpbGUnKTtcbiAgICAgIHByb3BzLnNob3VsZFNlbGVjdEJhc2VuYW1lID0gdHJ1ZTtcbiAgICAgIHZhciBjb21wb25lbnQgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgIHZhciB0ZXh0RWRpdG9yID0gY29tcG9uZW50LnJlZnNbJ2VudHJ5UGF0aCddLmdldFRleHRFZGl0b3IoKTtcblxuICAgICAgZXhwZWN0KHRleHRFZGl0b3IuZ2V0U2VsZWN0ZWRUZXh0KCkpLnRvQmUoJ2ZpbGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzZWxlY3RzIGEgZm9sZGVyIGJhc2VuYW1lJywgKCkgPT4ge1xuICAgICAgcHJvcHMuaW5pdGlhbEVudHJ5ID0gbmV3IERpcmVjdG9yeSgnL3Jvb3QvZGlyJyk7XG4gICAgICBwcm9wcy5zaG91bGRTZWxlY3RCYXNlbmFtZSA9IHRydWU7XG4gICAgICB2YXIgY29tcG9uZW50ID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gICAgICB2YXIgdGV4dEVkaXRvciA9IGNvbXBvbmVudC5yZWZzWydlbnRyeVBhdGgnXS5nZXRUZXh0RWRpdG9yKCk7XG5cbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yLmdldFNlbGVjdGVkVGV4dCgpKS50b0JlKCdkaXInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2luIGEgc3ViZGlyZWN0b3J5JywgKCkgPT4ge1xuICAgIGl0KCdyZWxhdGl2aXplcyBhIGZpbGUgcGF0aCcsICgpID0+IHtcbiAgICAgIHByb3BzLmluaXRpYWxFbnRyeSA9IG5ldyBGaWxlKCcvcm9vdC9zdWJkaXIvZmlsZS50eHQnKTtcbiAgICAgIHZhciBjb21wb25lbnQgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgIHZhciB0ZXh0RWRpdG9yID0gY29tcG9uZW50LnJlZnNbJ2VudHJ5UGF0aCddLmdldFRleHRFZGl0b3IoKTtcblxuICAgICAgZXhwZWN0KHRleHRFZGl0b3IuZ2V0VGV4dCgpKS50b0JlKCdzdWJkaXIvZmlsZS50eHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZWxhdGl2aXplcyBhIGZvbGRlciBwYXRoJywgKCkgPT4ge1xuICAgICAgcHJvcHMuaW5pdGlhbEVudHJ5ID0gbmV3IERpcmVjdG9yeSgnL3Jvb3Qvc3ViZGlyL2RpcicpO1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgdmFyIHRleHRFZGl0b3IgPSBjb21wb25lbnQucmVmc1snZW50cnlQYXRoJ10uZ2V0VGV4dEVkaXRvcigpO1xuXG4gICAgICBleHBlY3QodGV4dEVkaXRvci5nZXRUZXh0KCkpLnRvQmUoJ3N1YmRpci9kaXIvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2VsZWN0cyBhIGZpbGUgYmFzZW5hbWUgd2l0aCBhbiBleHRlbnNpb24nLCAoKSA9PiB7XG4gICAgICBwcm9wcy5pbml0aWFsRW50cnkgPSBuZXcgRmlsZSgnL3Jvb3Qvc3ViZGlyL2ZpbGUudHh0Jyk7XG4gICAgICBwcm9wcy5zaG91bGRTZWxlY3RCYXNlbmFtZSA9IHRydWU7XG4gICAgICB2YXIgY29tcG9uZW50ID0gcmVuZGVyQ29tcG9uZW50KCk7XG4gICAgICB2YXIgdGV4dEVkaXRvciA9IGNvbXBvbmVudC5yZWZzWydlbnRyeVBhdGgnXS5nZXRUZXh0RWRpdG9yKCk7XG5cbiAgICAgIGV4cGVjdCh0ZXh0RWRpdG9yLmdldFNlbGVjdGVkVGV4dCgpKS50b0JlKCdmaWxlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2VsZWN0cyBhIGZpbGUgYmFzZW5hbWUgd2l0aG91dCBhbiBleHRlbnNpb24nLCAoKSA9PiB7XG4gICAgICBwcm9wcy5pbml0aWFsRW50cnkgPSBuZXcgRmlsZSgnL3Jvb3Qvc3ViZGlyL2ZpbGUnKTtcbiAgICAgIHByb3BzLnNob3VsZFNlbGVjdEJhc2VuYW1lID0gdHJ1ZTtcbiAgICAgIHZhciBjb21wb25lbnQgPSByZW5kZXJDb21wb25lbnQoKTtcbiAgICAgIHZhciB0ZXh0RWRpdG9yID0gY29tcG9uZW50LnJlZnNbJ2VudHJ5UGF0aCddLmdldFRleHRFZGl0b3IoKTtcblxuICAgICAgZXhwZWN0KHRleHRFZGl0b3IuZ2V0U2VsZWN0ZWRUZXh0KCkpLnRvQmUoJ2ZpbGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzZWxlY3RzIGEgZm9sZGVyIGJhc2VuYW1lJywgKCkgPT4ge1xuICAgICAgcHJvcHMuaW5pdGlhbEVudHJ5ID0gbmV3IERpcmVjdG9yeSgnL3Jvb3Qvc3ViZGlyL2RpcicpO1xuICAgICAgcHJvcHMuc2hvdWxkU2VsZWN0QmFzZW5hbWUgPSB0cnVlO1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHJlbmRlckNvbXBvbmVudCgpO1xuICAgICAgdmFyIHRleHRFZGl0b3IgPSBjb21wb25lbnQucmVmc1snZW50cnlQYXRoJ10uZ2V0VGV4dEVkaXRvcigpO1xuXG4gICAgICBleHBlY3QodGV4dEVkaXRvci5nZXRTZWxlY3RlZFRleHQoKSkudG9CZSgnZGlyJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=