//   Copyright 2013-2014 Fran√ßois de Campredon
//
//   Licensed under the Apache License, Version 2.0 (the "License");
//   you may not use this file except in compliance with the License.
//   You may obtain a copy of the License at
//
//       http://www.apache.org/licenses/LICENSE-2.0
//
//   Unless required by applicable law or agreed to in writing, software
//   distributed under the License is distributed on an "AS IS" BASIS,
//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//   See the License for the specific language governing permissions and
//   limitations under the License.
'use strict';
var path = require('path');
function mapValues(map) {
    return Object.keys(map).reduce(function (result, key) {
        result.push(map[key]);
        return result;
    }, []);
}
exports.mapValues = mapValues;
function assign(target) {
    var items = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        items[_i - 1] = arguments[_i];
    }
    return items.reduce(function (target, source) {
        return Object.keys(source).reduce(function (target, key) {
            target[key] = source[key];
            return target;
        }, target);
    }, target);
}
exports.assign = assign;
function clone(target) {
    return assign(Array.isArray(target) ? [] : {}, target);
}
exports.clone = clone;
function createMap(arr) {
    return arr.reduce(function (result, key) {
        result[key] = true;
        return result;
    }, {});
}
exports.createMap = createMap;
function pathResolve(from, to) {
    var result = path.resolve(from, to);
    var index = result.indexOf(from[0]);
    return result.slice(index);
}
exports.pathResolve = pathResolve;
var Signal = (function () {
    function Signal() {
        this.listeners = [];
        this.priorities = [];
    }
    Signal.prototype.add = function (listener, priority) {
        if (priority === void 0) {
            priority = 0;
        }
        var index = this.listeners.indexOf(listener);
        if (index !== -1) {
            this.priorities[index] = priority;
            return;
        }
        for (var i = 0, l = this.priorities.length; i < l; i++) {
            if (this.priorities[i] < priority) {
                this.priorities.splice(i, 0, priority);
                this.listeners.splice(i, 0, listener);
                return;
            }
        }
        this.priorities.push(priority);
        this.listeners.push(listener);
    };
    Signal.prototype.remove = function (listener) {
        var index = this.listeners.indexOf(listener);
        if (index >= 0) {
            this.priorities.splice(index, 1);
            this.listeners.splice(index, 1);
        }
    };
    Signal.prototype.dispatch = function (parameter) {
        var hasBeenCanceled = this.listeners.every(function (listener) {
            var result = listener(parameter);
            return result !== false;
        });
        return hasBeenCanceled;
    };
    Signal.prototype.clear = function () {
        this.listeners = [];
        this.priorities = [];
    };
    Signal.prototype.hasListeners = function () {
        return this.listeners.length > 0;
    };
    return Signal;
})();
exports.Signal = Signal;
function binarySearch(array, value) {
    var low = 0;
    var high = array.length - 1;
    while (low <= high) {
        var middle = low + (high - low >> 1);
        var midValue = array[middle];
        if (midValue === value) {
            return middle;
        } else if (midValue > value) {
            high = middle - 1;
        } else {
            low = middle + 1;
        }
    }
    return ~low;
}
exports.binarySearch = binarySearch;
function selectMany(arr) {
    var result = [];
    for (var i = 0; i < arr.length; i++) {
        for (var j = 0; j < arr[i].length; j++) {
            result.push(arr[i][j]);
        }
    }
    return result;
}
exports.selectMany = selectMany;
function pathIsRelative(str) {
    if (!str.length) return false;
    return str[0] == '.' || str.substring(0, 2) == './' || str.substring(0, 3) == '../';
}
exports.pathIsRelative = pathIsRelative;
var Dict = (function () {
    function Dict() {
        this.table = Object.create(null);
    }
    Dict.prototype.setValue = function (key, item) {
        this.table[key] = item;
    };
    Dict.prototype.getValue = function (key) {
        return this.table[key];
    };
    Dict.prototype.clearValue = function (key) {
        delete this.table[key];
    };
    Dict.prototype.clearAll = function () {
        this.table = Object.create(null);
    };
    Dict.prototype.keys = function () {
        return Object.keys(this.table);
    };
    Dict.prototype.values = function () {
        var array = [];
        for (var key in this.table) {
            array.push(this.table[key]);
        }
        return array;
    };
    return Dict;
})();
exports.Dict = Dict;
function delay(seconds) {
    if (seconds === void 0) {
        seconds = 2;
    }
    delayMilliseconds(seconds * 1000);
}
exports.delay = delay;
;
function delayMilliseconds(milliseconds) {
    if (milliseconds === void 0) {
        milliseconds = 100;
    }
    var d1 = new Date();
    var d2 = new Date();
    while (d2.valueOf() < d1.valueOf() + milliseconds) {
        d2 = new Date();
    }
}
exports.delayMilliseconds = delayMilliseconds;
;
var now = function now() {
    return new Date().getTime();
};
function debounce(func, milliseconds, immediate) {
    if (immediate === void 0) {
        immediate = false;
    }
    var timeout, args, context, timestamp, result;
    var wait = milliseconds;
    var later = function later() {
        var last = now() - timestamp;
        if (last < wait && last > 0) {
            timeout = setTimeout(later, wait - last);
        } else {
            timeout = null;
            if (!immediate) {
                result = func.apply(context, args);
                if (!timeout) context = args = null;
            }
        }
    };
    return function () {
        context = this;
        args = arguments;
        timestamp = now();
        var callNow = immediate && !timeout;
        if (!timeout) timeout = setTimeout(later, wait);
        if (callNow) {
            result = func.apply(context, args);
            context = args = null;
        }
        return result;
    };
}
exports.debounce = debounce;
;
var punctuations = createMap([';', '{', '}', '(', ')', '.', ':', '<', '>', '\'', '"']);
exports.prefixEndsInPunctuation = function (prefix) {
    return prefix.length && prefix.trim().length && punctuations[prefix.trim()[prefix.trim().length - 1]];
};
var nameExtractorRegex = /return (.*);/;
function getName(nameLambda) {
    var m = nameExtractorRegex.exec(nameLambda + '');
    if (m == null) throw new Error('The function does not contain a statement matching \'return variableName;\'');
    var access = m[1].split('.');
    return access[access.length - 1];
}
exports.getName = getName;
function distinct(arr) {
    var map = createMap(arr);
    return Object.keys(map);
}
exports.distinct = distinct;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdqb25lcy8uYXRvbS9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvZGlzdC9tYWluL2xhbmcvdXRpbHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQWFBLFlBQVksQ0FBQztBQUNiLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixTQUFTLFNBQVMsQ0FBQyxHQUFHLEVBQUU7QUFDcEIsV0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLE1BQU0sRUFBRSxHQUFHLEVBQUU7QUFDbEQsY0FBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUN0QixlQUFPLE1BQU0sQ0FBQztLQUNqQixFQUFFLEVBQUUsQ0FBQyxDQUFDO0NBQ1Y7QUFDRCxPQUFPLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztBQUM5QixTQUFTLE1BQU0sQ0FBQyxNQUFNLEVBQUU7QUFDcEIsUUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO0FBQ2YsU0FBSyxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLEVBQUU7QUFDMUMsYUFBSyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDakM7QUFDRCxXQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBVSxNQUFNLEVBQUUsTUFBTSxFQUFFO0FBQzFDLGVBQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxNQUFNLEVBQUUsR0FBRyxFQUFFO0FBQ3JELGtCQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzFCLG1CQUFPLE1BQU0sQ0FBQztTQUNqQixFQUFFLE1BQU0sQ0FBQyxDQUFDO0tBQ2QsRUFBRSxNQUFNLENBQUMsQ0FBQztDQUNkO0FBQ0QsT0FBTyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7QUFDeEIsU0FBUyxLQUFLLENBQUMsTUFBTSxFQUFFO0FBQ25CLFdBQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQztDQUMxRDtBQUNELE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0FBQ3RCLFNBQVMsU0FBUyxDQUFDLEdBQUcsRUFBRTtBQUNwQixXQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxNQUFNLEVBQUUsR0FBRyxFQUFFO0FBQ3JDLGNBQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7QUFDbkIsZUFBTyxNQUFNLENBQUM7S0FDakIsRUFBRSxFQUFFLENBQUMsQ0FBQztDQUNWO0FBQ0QsT0FBTyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7QUFDOUIsU0FBUyxXQUFXLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRTtBQUMzQixRQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztBQUNwQyxRQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BDLFdBQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztDQUM5QjtBQUNELE9BQU8sQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO0FBQ2xDLElBQUksTUFBTSxHQUFHLENBQUMsWUFBWTtBQUN0QixhQUFTLE1BQU0sR0FBRztBQUNkLFlBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ3BCLFlBQUksQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO0tBQ3hCO0FBQ0QsVUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsVUFBVSxRQUFRLEVBQUUsUUFBUSxFQUFFO0FBQ2pELFlBQUksUUFBUSxLQUFLLEtBQUssQ0FBQyxFQUFFO0FBQUUsb0JBQVEsR0FBRyxDQUFDLENBQUM7U0FBRTtBQUMxQyxZQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUM3QyxZQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRTtBQUNkLGdCQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxHQUFHLFFBQVEsQ0FBQztBQUNsQyxtQkFBTztTQUNWO0FBQ0QsYUFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDcEQsZ0JBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLEVBQUU7QUFDL0Isb0JBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDdkMsb0JBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDdEMsdUJBQU87YUFDVjtTQUNKO0FBQ0QsWUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsWUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7S0FDakMsQ0FBQztBQUNGLFVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLFVBQVUsUUFBUSxFQUFFO0FBQzFDLFlBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzdDLFlBQUksS0FBSyxJQUFJLENBQUMsRUFBRTtBQUNaLGdCQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDakMsZ0JBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztTQUNuQztLQUNKLENBQUM7QUFDRixVQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxVQUFVLFNBQVMsRUFBRTtBQUM3QyxZQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxVQUFVLFFBQVEsRUFBRTtBQUMzRCxnQkFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2pDLG1CQUFPLE1BQU0sS0FBSyxLQUFLLENBQUM7U0FDM0IsQ0FBQyxDQUFDO0FBQ0gsZUFBTyxlQUFlLENBQUM7S0FDMUIsQ0FBQztBQUNGLFVBQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxHQUFHLFlBQVk7QUFDakMsWUFBSSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7QUFDcEIsWUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7S0FDeEIsQ0FBQztBQUNGLFVBQU0sQ0FBQyxTQUFTLENBQUMsWUFBWSxHQUFHLFlBQVk7QUFDeEMsZUFBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7S0FDcEMsQ0FBQztBQUNGLFdBQU8sTUFBTSxDQUFDO0NBQ2pCLENBQUEsRUFBRyxDQUFDO0FBQ0wsT0FBTyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7QUFDeEIsU0FBUyxZQUFZLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRTtBQUNoQyxRQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFDWixRQUFJLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztBQUM1QixXQUFPLEdBQUcsSUFBSSxJQUFJLEVBQUU7QUFDaEIsWUFBSSxNQUFNLEdBQUcsR0FBRyxJQUFJLEFBQUMsSUFBSSxHQUFHLEdBQUcsSUFBSyxDQUFDLENBQUEsQUFBQyxDQUFDO0FBQ3ZDLFlBQUksUUFBUSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixZQUFJLFFBQVEsS0FBSyxLQUFLLEVBQUU7QUFDcEIsbUJBQU8sTUFBTSxDQUFDO1NBQ2pCLE1BQ0ksSUFBSSxRQUFRLEdBQUcsS0FBSyxFQUFFO0FBQ3ZCLGdCQUFJLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQztTQUNyQixNQUNJO0FBQ0QsZUFBRyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUM7U0FDcEI7S0FDSjtBQUNELFdBQU8sQ0FBQyxHQUFHLENBQUM7Q0FDZjtBQUNELE9BQU8sQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO0FBQ3BDLFNBQVMsVUFBVSxDQUFDLEdBQUcsRUFBRTtBQUNyQixRQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFDaEIsU0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDakMsYUFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDcEMsa0JBQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDMUI7S0FDSjtBQUNELFdBQU8sTUFBTSxDQUFDO0NBQ2pCO0FBQ0QsT0FBTyxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7QUFDaEMsU0FBUyxjQUFjLENBQUMsR0FBRyxFQUFFO0FBQ3pCLFFBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUNYLE9BQU8sS0FBSyxDQUFDO0FBQ2pCLFdBQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDO0NBQ3ZGO0FBQ0QsT0FBTyxDQUFDLGNBQWMsR0FBRyxjQUFjLENBQUM7QUFDeEMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxZQUFZO0FBQ3BCLGFBQVMsSUFBSSxHQUFHO0FBQ1osWUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3BDO0FBQ0QsUUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEdBQUcsVUFBVSxHQUFHLEVBQUUsSUFBSSxFQUFFO0FBQzNDLFlBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO0tBQzFCLENBQUM7QUFDRixRQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxVQUFVLEdBQUcsRUFBRTtBQUFFLGVBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUFFLENBQUM7QUFDckUsUUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsVUFBVSxHQUFHLEVBQUU7QUFDdkMsZUFBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQzFCLENBQUM7QUFDRixRQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxZQUFZO0FBQUUsWUFBSSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQUUsQ0FBQztBQUM1RSxRQUFJLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxZQUFZO0FBQUUsZUFBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUFFLENBQUM7QUFDdEUsUUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsWUFBWTtBQUNoQyxZQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7QUFDZixhQUFLLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxLQUFLLEVBQUU7QUFDeEIsaUJBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQy9CO0FBQ0QsZUFBTyxLQUFLLENBQUM7S0FDaEIsQ0FBQztBQUNGLFdBQU8sSUFBSSxDQUFDO0NBQ2YsQ0FBQSxFQUFHLENBQUM7QUFDTCxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztBQUNwQixTQUFTLEtBQUssQ0FBQyxPQUFPLEVBQUU7QUFDcEIsUUFBSSxPQUFPLEtBQUssS0FBSyxDQUFDLEVBQUU7QUFBRSxlQUFPLEdBQUcsQ0FBQyxDQUFDO0tBQUU7QUFDeEMscUJBQWlCLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDO0NBQ3JDO0FBQ0QsT0FBTyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7QUFDdEIsQ0FBQztBQUNELFNBQVMsaUJBQWlCLENBQUMsWUFBWSxFQUFFO0FBQ3JDLFFBQUksWUFBWSxLQUFLLEtBQUssQ0FBQyxFQUFFO0FBQUUsb0JBQVksR0FBRyxHQUFHLENBQUM7S0FBRTtBQUNwRCxRQUFJLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0FBQ3BCLFFBQUksRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7QUFDcEIsV0FBTyxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sRUFBRSxHQUFHLFlBQVksRUFBRTtBQUMvQyxVQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztLQUNuQjtDQUNKO0FBQ0QsT0FBTyxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDO0FBQzlDLENBQUM7QUFDRCxJQUFJLEdBQUcsR0FBRyxTQUFOLEdBQUcsR0FBZTtBQUFFLFdBQU8sSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztDQUFFLENBQUM7QUFDdkQsU0FBUyxRQUFRLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUU7QUFDN0MsUUFBSSxTQUFTLEtBQUssS0FBSyxDQUFDLEVBQUU7QUFBRSxpQkFBUyxHQUFHLEtBQUssQ0FBQztLQUFFO0FBQ2hELFFBQUksT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQztBQUM5QyxRQUFJLElBQUksR0FBRyxZQUFZLENBQUM7QUFDeEIsUUFBSSxLQUFLLEdBQUcsU0FBUixLQUFLLEdBQWU7QUFDcEIsWUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDO0FBQzdCLFlBQUksSUFBSSxHQUFHLElBQUksSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFFO0FBQ3pCLG1CQUFPLEdBQUcsVUFBVSxDQUFDLEtBQUssRUFBRSxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDNUMsTUFDSTtBQUNELG1CQUFPLEdBQUcsSUFBSSxDQUFDO0FBQ2YsZ0JBQUksQ0FBQyxTQUFTLEVBQUU7QUFDWixzQkFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQ25DLG9CQUFJLENBQUMsT0FBTyxFQUNSLE9BQU8sR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDO2FBQzdCO1NBQ0o7S0FDSixDQUFDO0FBQ0YsV0FBTyxZQUFZO0FBQ2YsZUFBTyxHQUFHLElBQUksQ0FBQztBQUNmLFlBQUksR0FBRyxTQUFTLENBQUM7QUFDakIsaUJBQVMsR0FBRyxHQUFHLEVBQUUsQ0FBQztBQUNsQixZQUFJLE9BQU8sR0FBRyxTQUFTLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDcEMsWUFBSSxDQUFDLE9BQU8sRUFDUixPQUFPLEdBQUcsVUFBVSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztBQUN0QyxZQUFJLE9BQU8sRUFBRTtBQUNULGtCQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDbkMsbUJBQU8sR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO0FBQ0QsZUFBTyxNQUFNLENBQUM7S0FDakIsQ0FBQztDQUNMO0FBQ0QsT0FBTyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7QUFDNUIsQ0FBQztBQUNELElBQUksWUFBWSxHQUFHLFNBQVMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ3RGLE9BQU8sQ0FBQyx1QkFBdUIsR0FBRyxVQUFVLE1BQU0sRUFBRTtBQUFFLFdBQU8sTUFBTSxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxJQUFJLFlBQVksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQUUsQ0FBQztBQUMvSixJQUFJLGtCQUFrQixHQUFHLGNBQWMsQ0FBQztBQUN4QyxTQUFTLE9BQU8sQ0FBQyxVQUFVLEVBQUU7QUFDekIsUUFBSSxDQUFDLEdBQUcsa0JBQWtCLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUNqRCxRQUFJLENBQUMsSUFBSSxJQUFJLEVBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyw2RUFBMkUsQ0FBQyxDQUFDO0FBQ2pHLFFBQUksTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDN0IsV0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztDQUNwQztBQUNELE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0FBQzFCLFNBQVMsUUFBUSxDQUFDLEdBQUcsRUFBRTtBQUNuQixRQUFJLEdBQUcsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDekIsV0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQzNCO0FBQ0QsT0FBTyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMiLCJmaWxlIjoiL1VzZXJzL2FuZHJld2pvbmVzLy5hdG9tL3BhY2thZ2VzL2F0b20tdHlwZXNjcmlwdC9kaXN0L21haW4vbGFuZy91dGlscy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vICAgQ29weXJpZ2h0IDIwMTMtMjAxNCBGcmFuw6dvaXMgZGUgQ2FtcHJlZG9uXG4vL1xuLy8gICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8gICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyAgIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vICAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyAgIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuLy8gICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuJ3VzZSBzdHJpY3QnO1xudmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5mdW5jdGlvbiBtYXBWYWx1ZXMobWFwKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG1hcCkucmVkdWNlKGZ1bmN0aW9uIChyZXN1bHQsIGtleSkge1xuICAgICAgICByZXN1bHQucHVzaChtYXBba2V5XSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSwgW10pO1xufVxuZXhwb3J0cy5tYXBWYWx1ZXMgPSBtYXBWYWx1ZXM7XG5mdW5jdGlvbiBhc3NpZ24odGFyZ2V0KSB7XG4gICAgdmFyIGl0ZW1zID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgaXRlbXNbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgfVxuICAgIHJldHVybiBpdGVtcy5yZWR1Y2UoZnVuY3Rpb24gKHRhcmdldCwgc291cmNlKSB7XG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhzb3VyY2UpLnJlZHVjZShmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHtcbiAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9LCB0YXJnZXQpO1xuICAgIH0sIHRhcmdldCk7XG59XG5leHBvcnRzLmFzc2lnbiA9IGFzc2lnbjtcbmZ1bmN0aW9uIGNsb25lKHRhcmdldCkge1xuICAgIHJldHVybiBhc3NpZ24oQXJyYXkuaXNBcnJheSh0YXJnZXQpID8gW10gOiB7fSwgdGFyZ2V0KTtcbn1cbmV4cG9ydHMuY2xvbmUgPSBjbG9uZTtcbmZ1bmN0aW9uIGNyZWF0ZU1hcChhcnIpIHtcbiAgICByZXR1cm4gYXJyLnJlZHVjZShmdW5jdGlvbiAocmVzdWx0LCBrZXkpIHtcbiAgICAgICAgcmVzdWx0W2tleV0gPSB0cnVlO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sIHt9KTtcbn1cbmV4cG9ydHMuY3JlYXRlTWFwID0gY3JlYXRlTWFwO1xuZnVuY3Rpb24gcGF0aFJlc29sdmUoZnJvbSwgdG8pIHtcbiAgICB2YXIgcmVzdWx0ID0gcGF0aC5yZXNvbHZlKGZyb20sIHRvKTtcbiAgICB2YXIgaW5kZXggPSByZXN1bHQuaW5kZXhPZihmcm9tWzBdKTtcbiAgICByZXR1cm4gcmVzdWx0LnNsaWNlKGluZGV4KTtcbn1cbmV4cG9ydHMucGF0aFJlc29sdmUgPSBwYXRoUmVzb2x2ZTtcbnZhciBTaWduYWwgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNpZ25hbCgpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcbiAgICAgICAgdGhpcy5wcmlvcml0aWVzID0gW107XG4gICAgfVxuICAgIFNpZ25hbC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGxpc3RlbmVyLCBwcmlvcml0eSkge1xuICAgICAgICBpZiAocHJpb3JpdHkgPT09IHZvaWQgMCkgeyBwcmlvcml0eSA9IDA7IH1cbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5saXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdGllc1tpbmRleF0gPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMucHJpb3JpdGllcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByaW9yaXRpZXNbaV0gPCBwcmlvcml0eSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJpb3JpdGllcy5zcGxpY2UoaSwgMCwgcHJpb3JpdHkpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzLnNwbGljZShpLCAwLCBsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJpb3JpdGllcy5wdXNoKHByaW9yaXR5KTtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gICAgfTtcbiAgICBTaWduYWwucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uIChsaXN0ZW5lcikge1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmxpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKTtcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdGllcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2lnbmFsLnByb3RvdHlwZS5kaXNwYXRjaCA9IGZ1bmN0aW9uIChwYXJhbWV0ZXIpIHtcbiAgICAgICAgdmFyIGhhc0JlZW5DYW5jZWxlZCA9IHRoaXMubGlzdGVuZXJzLmV2ZXJ5KGZ1bmN0aW9uIChsaXN0ZW5lcikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGxpc3RlbmVyKHBhcmFtZXRlcik7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0ICE9PSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBoYXNCZWVuQ2FuY2VsZWQ7XG4gICAgfTtcbiAgICBTaWduYWwucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmxpc3RlbmVycyA9IFtdO1xuICAgICAgICB0aGlzLnByaW9yaXRpZXMgPSBbXTtcbiAgICB9O1xuICAgIFNpZ25hbC5wcm90b3R5cGUuaGFzTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lcnMubGVuZ3RoID4gMDtcbiAgICB9O1xuICAgIHJldHVybiBTaWduYWw7XG59KSgpO1xuZXhwb3J0cy5TaWduYWwgPSBTaWduYWw7XG5mdW5jdGlvbiBiaW5hcnlTZWFyY2goYXJyYXksIHZhbHVlKSB7XG4gICAgdmFyIGxvdyA9IDA7XG4gICAgdmFyIGhpZ2ggPSBhcnJheS5sZW5ndGggLSAxO1xuICAgIHdoaWxlIChsb3cgPD0gaGlnaCkge1xuICAgICAgICB2YXIgbWlkZGxlID0gbG93ICsgKChoaWdoIC0gbG93KSA+PiAxKTtcbiAgICAgICAgdmFyIG1pZFZhbHVlID0gYXJyYXlbbWlkZGxlXTtcbiAgICAgICAgaWYgKG1pZFZhbHVlID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG1pZGRsZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChtaWRWYWx1ZSA+IHZhbHVlKSB7XG4gICAgICAgICAgICBoaWdoID0gbWlkZGxlIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxvdyA9IG1pZGRsZSArIDE7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIH5sb3c7XG59XG5leHBvcnRzLmJpbmFyeVNlYXJjaCA9IGJpbmFyeVNlYXJjaDtcbmZ1bmN0aW9uIHNlbGVjdE1hbnkoYXJyKSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgYXJyW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChhcnJbaV1bal0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLnNlbGVjdE1hbnkgPSBzZWxlY3RNYW55O1xuZnVuY3Rpb24gcGF0aElzUmVsYXRpdmUoc3RyKSB7XG4gICAgaWYgKCFzdHIubGVuZ3RoKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHN0clswXSA9PSAnLicgfHwgc3RyLnN1YnN0cmluZygwLCAyKSA9PSBcIi4vXCIgfHwgc3RyLnN1YnN0cmluZygwLCAzKSA9PSBcIi4uL1wiO1xufVxuZXhwb3J0cy5wYXRoSXNSZWxhdGl2ZSA9IHBhdGhJc1JlbGF0aXZlO1xudmFyIERpY3QgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERpY3QoKSB7XG4gICAgICAgIHRoaXMudGFibGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIH1cbiAgICBEaWN0LnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIChrZXksIGl0ZW0pIHtcbiAgICAgICAgdGhpcy50YWJsZVtrZXldID0gaXRlbTtcbiAgICB9O1xuICAgIERpY3QucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKGtleSkgeyByZXR1cm4gdGhpcy50YWJsZVtrZXldOyB9O1xuICAgIERpY3QucHJvdG90eXBlLmNsZWFyVmFsdWUgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnRhYmxlW2tleV07XG4gICAgfTtcbiAgICBEaWN0LnByb3RvdHlwZS5jbGVhckFsbCA9IGZ1bmN0aW9uICgpIHsgdGhpcy50YWJsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7IH07XG4gICAgRGljdC5wcm90b3R5cGUua2V5cyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMudGFibGUpOyB9O1xuICAgIERpY3QucHJvdG90eXBlLnZhbHVlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGFycmF5ID0gW107XG4gICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnRhYmxlKSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKHRoaXMudGFibGVba2V5XSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH07XG4gICAgcmV0dXJuIERpY3Q7XG59KSgpO1xuZXhwb3J0cy5EaWN0ID0gRGljdDtcbmZ1bmN0aW9uIGRlbGF5KHNlY29uZHMpIHtcbiAgICBpZiAoc2Vjb25kcyA9PT0gdm9pZCAwKSB7IHNlY29uZHMgPSAyOyB9XG4gICAgZGVsYXlNaWxsaXNlY29uZHMoc2Vjb25kcyAqIDEwMDApO1xufVxuZXhwb3J0cy5kZWxheSA9IGRlbGF5O1xuO1xuZnVuY3Rpb24gZGVsYXlNaWxsaXNlY29uZHMobWlsbGlzZWNvbmRzKSB7XG4gICAgaWYgKG1pbGxpc2Vjb25kcyA9PT0gdm9pZCAwKSB7IG1pbGxpc2Vjb25kcyA9IDEwMDsgfVxuICAgIHZhciBkMSA9IG5ldyBEYXRlKCk7XG4gICAgdmFyIGQyID0gbmV3IERhdGUoKTtcbiAgICB3aGlsZSAoZDIudmFsdWVPZigpIDwgZDEudmFsdWVPZigpICsgbWlsbGlzZWNvbmRzKSB7XG4gICAgICAgIGQyID0gbmV3IERhdGUoKTtcbiAgICB9XG59XG5leHBvcnRzLmRlbGF5TWlsbGlzZWNvbmRzID0gZGVsYXlNaWxsaXNlY29uZHM7XG47XG52YXIgbm93ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7IH07XG5mdW5jdGlvbiBkZWJvdW5jZShmdW5jLCBtaWxsaXNlY29uZHMsIGltbWVkaWF0ZSkge1xuICAgIGlmIChpbW1lZGlhdGUgPT09IHZvaWQgMCkgeyBpbW1lZGlhdGUgPSBmYWxzZTsgfVxuICAgIHZhciB0aW1lb3V0LCBhcmdzLCBjb250ZXh0LCB0aW1lc3RhbXAsIHJlc3VsdDtcbiAgICB2YXIgd2FpdCA9IG1pbGxpc2Vjb25kcztcbiAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBsYXN0ID0gbm93KCkgLSB0aW1lc3RhbXA7XG4gICAgICAgIGlmIChsYXN0IDwgd2FpdCAmJiBsYXN0ID4gMCkge1xuICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQgLSBsYXN0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIGlmICghdGltZW91dClcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBjb250ZXh0ID0gdGhpcztcbiAgICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgdGltZXN0YW1wID0gbm93KCk7XG4gICAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgICAgICBpZiAoIXRpbWVvdXQpXG4gICAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gICAgICAgIGlmIChjYWxsTm93KSB7XG4gICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbn1cbmV4cG9ydHMuZGVib3VuY2UgPSBkZWJvdW5jZTtcbjtcbnZhciBwdW5jdHVhdGlvbnMgPSBjcmVhdGVNYXAoWyc7JywgJ3snLCAnfScsICcoJywgJyknLCAnLicsICc6JywgJzwnLCAnPicsIFwiJ1wiLCAnXCInXSk7XG5leHBvcnRzLnByZWZpeEVuZHNJblB1bmN0dWF0aW9uID0gZnVuY3Rpb24gKHByZWZpeCkgeyByZXR1cm4gcHJlZml4Lmxlbmd0aCAmJiBwcmVmaXgudHJpbSgpLmxlbmd0aCAmJiBwdW5jdHVhdGlvbnNbcHJlZml4LnRyaW0oKVtwcmVmaXgudHJpbSgpLmxlbmd0aCAtIDFdXTsgfTtcbnZhciBuYW1lRXh0cmFjdG9yUmVnZXggPSAvcmV0dXJuICguKik7LztcbmZ1bmN0aW9uIGdldE5hbWUobmFtZUxhbWJkYSkge1xuICAgIHZhciBtID0gbmFtZUV4dHJhY3RvclJlZ2V4LmV4ZWMobmFtZUxhbWJkYSArIFwiXCIpO1xuICAgIGlmIChtID09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBmdW5jdGlvbiBkb2VzIG5vdCBjb250YWluIGEgc3RhdGVtZW50IG1hdGNoaW5nICdyZXR1cm4gdmFyaWFibGVOYW1lOydcIik7XG4gICAgdmFyIGFjY2VzcyA9IG1bMV0uc3BsaXQoJy4nKTtcbiAgICByZXR1cm4gYWNjZXNzW2FjY2Vzcy5sZW5ndGggLSAxXTtcbn1cbmV4cG9ydHMuZ2V0TmFtZSA9IGdldE5hbWU7XG5mdW5jdGlvbiBkaXN0aW5jdChhcnIpIHtcbiAgICB2YXIgbWFwID0gY3JlYXRlTWFwKGFycik7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG1hcCk7XG59XG5leHBvcnRzLmRpc3RpbmN0ID0gZGlzdGluY3Q7XG4iXX0=