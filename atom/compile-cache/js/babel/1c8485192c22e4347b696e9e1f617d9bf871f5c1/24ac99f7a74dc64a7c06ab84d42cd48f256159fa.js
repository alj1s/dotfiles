var __extends = this && this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() {
        this.constructor = d;
    }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var view = require('./view');
var $ = view.$;
var html = require('../../../../views/renameView.html');
var RenameView = (function (_super) {
    __extends(RenameView, _super);
    function RenameView() {
        _super.apply(this, arguments);
        this.editorAtRenameStart = null;
    }
    RenameView.prototype.init = function () {
        var _this = this;
        $(atom.views.getView(atom.workspace)).on('keydown', function (e) {
            if (e.keyCode == 27) {
                if (_this.options.onCancel) {
                    _this.options.onCancel();
                    _this.clearView();
                }
            }
        });
        this.newNameEditor.on('keydown', function (e) {
            var newText = _this.newNameEditor.model.getText();
            if (e.keyCode == 13) {
                var invalid = _this.options.onValidate(newText);
                if (invalid) {
                    _this.validationMessage.text(invalid);
                    _this.validationMessage.show();
                    return;
                }
                _this.validationMessage.hide();
                if (_this.options.onCommit) {
                    _this.options.onCommit(newText);
                    _this.clearView();
                }
            }
            if (e.keyCode == 27) {
                if (_this.options.onCancel) {
                    _this.options.onCancel();
                    _this.clearView();
                }
            }
        });
    };
    RenameView.prototype.clearView = function () {
        if (this.editorAtRenameStart && !this.editorAtRenameStart.isDestroyed()) {
            var view = atom.views.getView(this.editorAtRenameStart);
            view.focus();
        }
        panel.hide();
        this.options = {};
        this.editorAtRenameStart = null;
    };
    RenameView.prototype.renameThis = function (options) {
        this.options = options;
        this.editorAtRenameStart = atom.workspace.getActiveTextEditor();
        panel.show();
        this.newNameEditor.model.setText(options.text);
        if (this.options.autoSelect) {
            this.newNameEditor.model.selectAll();
        } else {
            this.newNameEditor.model.moveToEndOfScreenLine();
        }
        this.title.text(this.options.title);
        this.newNameEditor.focus();
        this.validationMessage.hide();
        this.fileCount.html('<div>\n            Files Counts: <span class=\'highlight\'> Already Open ( ' + options.openFiles.length + ' )</span> and <span class=\'highlight\'> Currently Closed ( ' + options.closedFiles.length + ' ) </span>\n        </div>');
    };
    RenameView.content = html;
    return RenameView;
})(view.View);
exports.RenameView = RenameView;
var panel;
function attach() {
    exports.panelView = new RenameView({});
    panel = atom.workspace.addModalPanel({ item: exports.panelView, priority: 1000, visible: false });
}
exports.attach = attach;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdqb25lcy8uYXRvbS9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvZGlzdC9tYWluL2F0b20vdmlld3MvcmVuYW1lVmlldy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLFNBQVMsR0FBRyxBQUFDLElBQUksSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFLLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRTtBQUN4RCxTQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN0RCxhQUFTLEVBQUUsR0FBRztBQUFFLFlBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO0tBQUU7QUFDdkMsS0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLEtBQUssSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUEsQUFBQyxDQUFDO0NBQ3hGLENBQUM7QUFDRixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDN0IsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNmLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3hELElBQUksVUFBVSxHQUFHLENBQUMsVUFBVSxNQUFNLEVBQUU7QUFDaEMsYUFBUyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUM5QixhQUFTLFVBQVUsR0FBRztBQUNsQixjQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztBQUM5QixZQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxDQUFDO0tBQ25DO0FBQ0QsY0FBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsWUFBWTtBQUNwQyxZQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7QUFDakIsU0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsVUFBVSxDQUFDLEVBQUU7QUFDN0QsZ0JBQUksQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLEVBQUU7QUFDakIsb0JBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUU7QUFDeEIseUJBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDekIseUJBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztpQkFDckI7YUFDSjtTQUNKLENBQUMsQ0FBQztBQUNILFlBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxVQUFVLENBQUMsRUFBRTtBQUMxQyxnQkFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDbEQsZ0JBQUksQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLEVBQUU7QUFDakIsb0JBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ2hELG9CQUFJLE9BQU8sRUFBRTtBQUNULHlCQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RDLHlCQUFLLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDL0IsMkJBQU87aUJBQ1Y7QUFDRCxxQkFBSyxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxDQUFDO0FBQy9CLG9CQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFO0FBQ3hCLHlCQUFLLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNoQyx5QkFBSyxDQUFDLFNBQVMsRUFBRSxDQUFDO2lCQUNyQjthQUNKO0FBQ0QsZ0JBQUksQ0FBQyxDQUFDLE9BQU8sSUFBSSxFQUFFLEVBQUU7QUFDakIsb0JBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUU7QUFDeEIseUJBQUssQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDekIseUJBQUssQ0FBQyxTQUFTLEVBQUUsQ0FBQztpQkFDckI7YUFDSjtTQUNKLENBQUMsQ0FBQztLQUNOLENBQUM7QUFDRixjQUFVLENBQUMsU0FBUyxDQUFDLFNBQVMsR0FBRyxZQUFZO0FBQ3pDLFlBQUksSUFBSSxDQUFDLG1CQUFtQixJQUFJLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxFQUFFO0FBQ3JFLGdCQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUN4RCxnQkFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ2hCO0FBQ0QsYUFBSyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ2IsWUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7QUFDbEIsWUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQztLQUNuQyxDQUFDO0FBQ0YsY0FBVSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsVUFBVSxPQUFPLEVBQUU7QUFDakQsWUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7QUFDdkIsWUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztBQUNoRSxhQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDYixZQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQy9DLFlBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUU7QUFDekIsZ0JBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3hDLE1BQ0k7QUFDRCxnQkFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMscUJBQXFCLEVBQUUsQ0FBQztTQUNwRDtBQUNELFlBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEMsWUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUMzQixZQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDOUIsWUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsNkVBQTJFLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsOERBQTRELEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsNEJBQTRCLENBQUMsQ0FBQztLQUMxUCxDQUFDO0FBQ0YsY0FBVSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDMUIsV0FBTyxVQUFVLENBQUM7Q0FDckIsQ0FBQSxDQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUNkLE9BQU8sQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0FBQ2hDLElBQUksS0FBSyxDQUFDO0FBQ1YsU0FBUyxNQUFNLEdBQUc7QUFDZCxXQUFPLENBQUMsU0FBUyxHQUFHLElBQUksVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZDLFNBQUssR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7Q0FDckc7QUFDRCxPQUFPLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyIsImZpbGUiOiIvVXNlcnMvYW5kcmV3am9uZXMvLmF0b20vcGFja2FnZXMvYXRvbS10eXBlc2NyaXB0L2Rpc3QvbWFpbi9hdG9tL3ZpZXdzL3JlbmFtZVZpZXcuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07XG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xufTtcbnZhciB2aWV3ID0gcmVxdWlyZSgnLi92aWV3Jyk7XG52YXIgJCA9IHZpZXcuJDtcbnZhciBodG1sID0gcmVxdWlyZSgnLi4vLi4vLi4vLi4vdmlld3MvcmVuYW1lVmlldy5odG1sJyk7XG52YXIgUmVuYW1lVmlldyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFJlbmFtZVZpZXcsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUmVuYW1lVmlldygpIHtcbiAgICAgICAgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMuZWRpdG9yQXRSZW5hbWVTdGFydCA9IG51bGw7XG4gICAgfVxuICAgIFJlbmFtZVZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgICQoYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKSkub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAyNykge1xuICAgICAgICAgICAgICAgIGlmIChfdGhpcy5vcHRpb25zLm9uQ2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLm9wdGlvbnMub25DYW5jZWwoKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY2xlYXJWaWV3KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5uZXdOYW1lRWRpdG9yLm9uKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBuZXdUZXh0ID0gX3RoaXMubmV3TmFtZUVkaXRvci5tb2RlbC5nZXRUZXh0KCk7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDEzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGludmFsaWQgPSBfdGhpcy5vcHRpb25zLm9uVmFsaWRhdGUobmV3VGV4dCk7XG4gICAgICAgICAgICAgICAgaWYgKGludmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsaWRhdGlvbk1lc3NhZ2UudGV4dChpbnZhbGlkKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmFsaWRhdGlvbk1lc3NhZ2Uuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLnZhbGlkYXRpb25NZXNzYWdlLmhpZGUoKTtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5vbkNvbW1pdCkge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5vcHRpb25zLm9uQ29tbWl0KG5ld1RleHQpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGVhclZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09IDI3KSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMub25DYW5jZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMub3B0aW9ucy5vbkNhbmNlbCgpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5jbGVhclZpZXcoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUmVuYW1lVmlldy5wcm90b3R5cGUuY2xlYXJWaWV3ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5lZGl0b3JBdFJlbmFtZVN0YXJ0ICYmICF0aGlzLmVkaXRvckF0UmVuYW1lU3RhcnQuaXNEZXN0cm95ZWQoKSkge1xuICAgICAgICAgICAgdmFyIHZpZXcgPSBhdG9tLnZpZXdzLmdldFZpZXcodGhpcy5lZGl0b3JBdFJlbmFtZVN0YXJ0KTtcbiAgICAgICAgICAgIHZpZXcuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgICBwYW5lbC5oaWRlKCk7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHt9O1xuICAgICAgICB0aGlzLmVkaXRvckF0UmVuYW1lU3RhcnQgPSBudWxsO1xuICAgIH07XG4gICAgUmVuYW1lVmlldy5wcm90b3R5cGUucmVuYW1lVGhpcyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gICAgICAgIHRoaXMuZWRpdG9yQXRSZW5hbWVTdGFydCA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKTtcbiAgICAgICAgcGFuZWwuc2hvdygpO1xuICAgICAgICB0aGlzLm5ld05hbWVFZGl0b3IubW9kZWwuc2V0VGV4dChvcHRpb25zLnRleHQpO1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9TZWxlY3QpIHtcbiAgICAgICAgICAgIHRoaXMubmV3TmFtZUVkaXRvci5tb2RlbC5zZWxlY3RBbGwoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubmV3TmFtZUVkaXRvci5tb2RlbC5tb3ZlVG9FbmRPZlNjcmVlbkxpbmUoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpdGxlLnRleHQodGhpcy5vcHRpb25zLnRpdGxlKTtcbiAgICAgICAgdGhpcy5uZXdOYW1lRWRpdG9yLmZvY3VzKCk7XG4gICAgICAgIHRoaXMudmFsaWRhdGlvbk1lc3NhZ2UuaGlkZSgpO1xuICAgICAgICB0aGlzLmZpbGVDb3VudC5odG1sKFwiPGRpdj5cXG4gICAgICAgICAgICBGaWxlcyBDb3VudHM6IDxzcGFuIGNsYXNzPSdoaWdobGlnaHQnPiBBbHJlYWR5IE9wZW4gKCBcIiArIG9wdGlvbnMub3BlbkZpbGVzLmxlbmd0aCArIFwiICk8L3NwYW4+IGFuZCA8c3BhbiBjbGFzcz0naGlnaGxpZ2h0Jz4gQ3VycmVudGx5IENsb3NlZCAoIFwiICsgb3B0aW9ucy5jbG9zZWRGaWxlcy5sZW5ndGggKyBcIiApIDwvc3Bhbj5cXG4gICAgICAgIDwvZGl2PlwiKTtcbiAgICB9O1xuICAgIFJlbmFtZVZpZXcuY29udGVudCA9IGh0bWw7XG4gICAgcmV0dXJuIFJlbmFtZVZpZXc7XG59KSh2aWV3LlZpZXcpO1xuZXhwb3J0cy5SZW5hbWVWaWV3ID0gUmVuYW1lVmlldztcbnZhciBwYW5lbDtcbmZ1bmN0aW9uIGF0dGFjaCgpIHtcbiAgICBleHBvcnRzLnBhbmVsVmlldyA9IG5ldyBSZW5hbWVWaWV3KHt9KTtcbiAgICBwYW5lbCA9IGF0b20ud29ya3NwYWNlLmFkZE1vZGFsUGFuZWwoeyBpdGVtOiBleHBvcnRzLnBhbmVsVmlldywgcHJpb3JpdHk6IDEwMDAsIHZpc2libGU6IGZhbHNlIH0pO1xufVxuZXhwb3J0cy5hdHRhY2ggPSBhdHRhY2g7XG4iXX0=