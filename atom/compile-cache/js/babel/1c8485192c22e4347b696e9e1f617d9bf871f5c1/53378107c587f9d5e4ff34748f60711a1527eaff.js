var utils_1 = require("../lang/utils");
var parent = require("../../worker/parent");
var atomUtils = require("./atomUtils");
var transformer_1 = require("../lang/transformers/transformer");
function setupEditor(editor) {
    var quickFixDecoration = null;
    var quickFixMarker = null;
    function clearExistingQuickfixDecoration() {
        if (quickFixDecoration) {
            quickFixDecoration.destroy();
            quickFixDecoration = null;
        }
        if (quickFixMarker) {
            quickFixMarker.destroy();
            quickFixMarker = null;
        }
    }
    var queryForQuickFix = utils_1.debounce(function (filePathPosition) {
        parent.getQuickFixes(filePathPosition).then(function (res) {
            clearExistingQuickfixDecoration();
            if (res.fixes.length) {
                quickFixMarker = editor.markBufferRange(editor.getSelectedBufferRange());
                quickFixDecoration = editor.decorateMarker(quickFixMarker, { type: "line-number", "class": "quickfix" });
            }
        });
    }, 500);
    var cursorObserver = editor.onDidChangeCursorPosition(function () {
        try {
            var pathPos = atomUtils.getFilePathPosition();
            if (transformer_1.isTransformerFile(pathPos.filePath)) {
                clearExistingQuickfixDecoration();
                return;
            }
            queryForQuickFix(pathPos);
        } catch (ex) {
            clearExistingQuickfixDecoration();
        }
    });
    var destroyObserver = editor.onDidDestroy(function () {
        cursorObserver.dispose();
        destroyObserver.dispose();
    });
}
exports.setupEditor = setupEditor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hbmRyZXdqb25lcy8uYXRvbS9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvZGlzdC9tYWluL2F0b20vZWRpdG9yU2V0dXAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQ3ZDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN2QyxJQUFJLGFBQWEsR0FBRyxPQUFPLENBQUMsa0NBQWtDLENBQUMsQ0FBQztBQUNoRSxTQUFTLFdBQVcsQ0FBQyxNQUFNLEVBQUU7QUFDekIsUUFBSSxrQkFBa0IsR0FBRyxJQUFJLENBQUM7QUFDOUIsUUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDO0FBQzFCLGFBQVMsK0JBQStCLEdBQUc7QUFDdkMsWUFBSSxrQkFBa0IsRUFBRTtBQUNwQiw4QkFBa0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUM3Qiw4QkFBa0IsR0FBRyxJQUFJLENBQUM7U0FDN0I7QUFDRCxZQUFJLGNBQWMsRUFBRTtBQUNoQiwwQkFBYyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3pCLDBCQUFjLEdBQUcsSUFBSSxDQUFDO1NBQ3pCO0tBQ0o7QUFDRCxRQUFJLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxnQkFBZ0IsRUFBRTtBQUNoRSxjQUFNLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFO0FBQ3ZELDJDQUErQixFQUFFLENBQUM7QUFDbEMsZ0JBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7QUFDbEIsOEJBQWMsR0FBRyxNQUFNLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLENBQUM7QUFDekUsa0NBQWtCLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLEVBQUUsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLFNBQU8sVUFBVSxFQUFFLENBQUMsQ0FBQzthQUMxRztTQUNKLENBQUMsQ0FBQztLQUNOLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDUixRQUFJLGNBQWMsR0FBRyxNQUFNLENBQUMseUJBQXlCLENBQUMsWUFBWTtBQUM5RCxZQUFJO0FBQ0EsZ0JBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0FBQzlDLGdCQUFJLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUU7QUFDbkQsK0NBQStCLEVBQUUsQ0FBQztBQUNsQyx1QkFBTzthQUNWO0FBQ0QsNEJBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDN0IsQ0FDRCxPQUFPLEVBQUUsRUFBRTtBQUNQLDJDQUErQixFQUFFLENBQUM7U0FDckM7S0FDSixDQUFDLENBQUM7QUFDSCxRQUFJLGVBQWUsR0FBRyxNQUFNLENBQUMsWUFBWSxDQUFDLFlBQVk7QUFDbEQsc0JBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUN6Qix1QkFBZSxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQzdCLENBQUMsQ0FBQztDQUNOO0FBQ0QsT0FBTyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMiLCJmaWxlIjoiL1VzZXJzL2FuZHJld2pvbmVzLy5hdG9tL3BhY2thZ2VzL2F0b20tdHlwZXNjcmlwdC9kaXN0L21haW4vYXRvbS9lZGl0b3JTZXR1cC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciB1dGlsc18xID0gcmVxdWlyZShcIi4uL2xhbmcvdXRpbHNcIik7XG52YXIgcGFyZW50ID0gcmVxdWlyZShcIi4uLy4uL3dvcmtlci9wYXJlbnRcIik7XG52YXIgYXRvbVV0aWxzID0gcmVxdWlyZShcIi4vYXRvbVV0aWxzXCIpO1xudmFyIHRyYW5zZm9ybWVyXzEgPSByZXF1aXJlKFwiLi4vbGFuZy90cmFuc2Zvcm1lcnMvdHJhbnNmb3JtZXJcIik7XG5mdW5jdGlvbiBzZXR1cEVkaXRvcihlZGl0b3IpIHtcbiAgICB2YXIgcXVpY2tGaXhEZWNvcmF0aW9uID0gbnVsbDtcbiAgICB2YXIgcXVpY2tGaXhNYXJrZXIgPSBudWxsO1xuICAgIGZ1bmN0aW9uIGNsZWFyRXhpc3RpbmdRdWlja2ZpeERlY29yYXRpb24oKSB7XG4gICAgICAgIGlmIChxdWlja0ZpeERlY29yYXRpb24pIHtcbiAgICAgICAgICAgIHF1aWNrRml4RGVjb3JhdGlvbi5kZXN0cm95KCk7XG4gICAgICAgICAgICBxdWlja0ZpeERlY29yYXRpb24gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWlja0ZpeE1hcmtlcikge1xuICAgICAgICAgICAgcXVpY2tGaXhNYXJrZXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgcXVpY2tGaXhNYXJrZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHZhciBxdWVyeUZvclF1aWNrRml4ID0gdXRpbHNfMS5kZWJvdW5jZShmdW5jdGlvbiAoZmlsZVBhdGhQb3NpdGlvbikge1xuICAgICAgICBwYXJlbnQuZ2V0UXVpY2tGaXhlcyhmaWxlUGF0aFBvc2l0aW9uKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIGNsZWFyRXhpc3RpbmdRdWlja2ZpeERlY29yYXRpb24oKTtcbiAgICAgICAgICAgIGlmIChyZXMuZml4ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcXVpY2tGaXhNYXJrZXIgPSBlZGl0b3IubWFya0J1ZmZlclJhbmdlKGVkaXRvci5nZXRTZWxlY3RlZEJ1ZmZlclJhbmdlKCkpO1xuICAgICAgICAgICAgICAgIHF1aWNrRml4RGVjb3JhdGlvbiA9IGVkaXRvci5kZWNvcmF0ZU1hcmtlcihxdWlja0ZpeE1hcmtlciwgeyB0eXBlOiBcImxpbmUtbnVtYmVyXCIsIGNsYXNzOiBcInF1aWNrZml4XCIgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sIDUwMCk7XG4gICAgdmFyIGN1cnNvck9ic2VydmVyID0gZWRpdG9yLm9uRGlkQ2hhbmdlQ3Vyc29yUG9zaXRpb24oZnVuY3Rpb24gKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHBhdGhQb3MgPSBhdG9tVXRpbHMuZ2V0RmlsZVBhdGhQb3NpdGlvbigpO1xuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybWVyXzEuaXNUcmFuc2Zvcm1lckZpbGUocGF0aFBvcy5maWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICBjbGVhckV4aXN0aW5nUXVpY2tmaXhEZWNvcmF0aW9uKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcXVlcnlGb3JRdWlja0ZpeChwYXRoUG9zKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgIGNsZWFyRXhpc3RpbmdRdWlja2ZpeERlY29yYXRpb24oKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBkZXN0cm95T2JzZXJ2ZXIgPSBlZGl0b3Iub25EaWREZXN0cm95KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY3Vyc29yT2JzZXJ2ZXIuZGlzcG9zZSgpO1xuICAgICAgICBkZXN0cm95T2JzZXJ2ZXIuZGlzcG9zZSgpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5zZXR1cEVkaXRvciA9IHNldHVwRWRpdG9yO1xuIl19