////////////////////////////////// MAGIC
var vm = require('vm');
var fs = require('fs');
global.stack = function () {
    console.error((new Error()).stack);
};
/** Makes the bundled typescript services global or (if passed in) a custom typescriptServices file */
function makeTsGlobal(typescriptServices) {
    var sandbox = {
        // This is going to gather the ts module exports
        ts: {},
        console: console,
        stack: global.stack,
        require: require,
        module: module,
        process: process
    };
    vm.createContext(sandbox);
    if (typescriptServices) {
        vm.runInContext(fs.readFileSync(typescriptServices).toString(), sandbox);
    }
    else {
        vm.runInContext(fs.readFileSync(require.resolve('ntypescript')).toString(), sandbox);
    }
    // Finally export ts to the local global namespace
    global.ts = sandbox.ts;
}
exports.makeTsGlobal = makeTsGlobal;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2FuZHJld2pvbmVzLy5hdG9tL3BhY2thZ2VzL2F0b20tdHlwZXNjcmlwdC9saWIvdHlwZXNjcmlwdC9tYWtlVHlwZVNjcmlwdEdsb2JhbC50cyIsInNvdXJjZXMiOlsiL1VzZXJzL2FuZHJld2pvbmVzLy5hdG9tL3BhY2thZ2VzL2F0b20tdHlwZXNjcmlwdC9saWIvdHlwZXNjcmlwdC9tYWtlVHlwZVNjcmlwdEdsb2JhbC50cyJdLCJuYW1lcyI6WyJtYWtlVHNHbG9iYWwiXSwibWFwcGluZ3MiOiJBQUNBLEFBREEsd0NBQXdDO0FBQ3hDLElBQU8sRUFBRSxXQUFXLElBQUksQ0FBQyxDQUFDO0FBQzFCLElBQU8sRUFBRSxXQUFXLElBQUksQ0FBQyxDQUFDO0FBSTFCLE1BQU0sQ0FBQyxLQUFLLEdBQUc7SUFDWCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQU0sSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzVDLENBQUMsQ0FBQTtBQUdELEFBREEsc0dBQXNHO1NBQ3RGLFlBQVksQ0FBQyxrQkFBMkI7SUFDcERBLElBQUlBLE9BQU9BLEdBQUdBO1FBRVZBLEFBREFBLGdEQUFnREE7UUFDaERBLEVBQUVBLEVBQUVBLEVBQUVBO1FBQ05BLE9BQU9BLEVBQUVBLE9BQU9BO1FBQ2hCQSxLQUFLQSxFQUFFQSxNQUFNQSxDQUFDQSxLQUFLQTtRQUNuQkEsT0FBT0EsRUFBRUEsT0FBT0E7UUFDaEJBLE1BQU1BLEVBQUVBLE1BQU1BO1FBQ2RBLE9BQU9BLEVBQUVBLE9BQU9BO0tBQ25CQSxDQUFDQTtJQUNGQSxFQUFFQSxDQUFDQSxhQUFhQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtJQUUxQkEsRUFBRUEsQ0FBQ0EsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNyQkEsRUFBRUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsWUFBWUEsQ0FBQ0Esa0JBQWtCQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxFQUFFQSxPQUFPQSxDQUFDQSxDQUFDQTtJQUM3RUEsQ0FBQ0E7SUFDREEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDRkEsRUFBRUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7SUFDekZBLENBQUNBO0lBR0RBLEFBREFBLGtEQUFrREE7SUFDbERBLE1BQU1BLENBQUNBLEVBQUVBLEdBQUdBLE9BQU9BLENBQUNBLEVBQUVBLENBQUNBO0FBQzNCQSxDQUFDQTtBQXJCZSxvQkFBWSxHQUFaLFlBcUJmLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vIE1BR0lDXG5pbXBvcnQgdm0gPSByZXF1aXJlKCd2bScpO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmltcG9ydCBvcyA9IHJlcXVpcmUoJ29zJyk7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxuZ2xvYmFsLnN0YWNrID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5lcnJvcigoPGFueT5uZXcgRXJyb3IoKSkuc3RhY2spO1xufVxuXG4vKiogTWFrZXMgdGhlIGJ1bmRsZWQgdHlwZXNjcmlwdCBzZXJ2aWNlcyBnbG9iYWwgb3IgKGlmIHBhc3NlZCBpbikgYSBjdXN0b20gdHlwZXNjcmlwdFNlcnZpY2VzIGZpbGUgKi9cbmV4cG9ydCBmdW5jdGlvbiBtYWtlVHNHbG9iYWwodHlwZXNjcmlwdFNlcnZpY2VzPzogc3RyaW5nKSB7XG4gICAgdmFyIHNhbmRib3ggPSB7XG4gICAgICAgIC8vIFRoaXMgaXMgZ29pbmcgdG8gZ2F0aGVyIHRoZSB0cyBtb2R1bGUgZXhwb3J0c1xuICAgICAgICB0czoge30sXG4gICAgICAgIGNvbnNvbGU6IGNvbnNvbGUsXG4gICAgICAgIHN0YWNrOiBnbG9iYWwuc3RhY2ssXG4gICAgICAgIHJlcXVpcmU6IHJlcXVpcmUsXG4gICAgICAgIG1vZHVsZTogbW9kdWxlLFxuICAgICAgICBwcm9jZXNzOiBwcm9jZXNzXG4gICAgfTtcbiAgICB2bS5jcmVhdGVDb250ZXh0KHNhbmRib3gpO1xuXG4gICAgaWYgKHR5cGVzY3JpcHRTZXJ2aWNlcykge1xuICAgICAgICB2bS5ydW5JbkNvbnRleHQoZnMucmVhZEZpbGVTeW5jKHR5cGVzY3JpcHRTZXJ2aWNlcykudG9TdHJpbmcoKSwgc2FuZGJveCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2bS5ydW5JbkNvbnRleHQoZnMucmVhZEZpbGVTeW5jKHJlcXVpcmUucmVzb2x2ZSgnbnR5cGVzY3JpcHQnKSkudG9TdHJpbmcoKSwgc2FuZGJveCk7XG4gICAgfVxuXG4gICAgLy8gRmluYWxseSBleHBvcnQgdHMgdG8gdGhlIGxvY2FsIGdsb2JhbCBuYW1lc3BhY2VcbiAgICBnbG9iYWwudHMgPSBzYW5kYm94LnRzO1xufVxuIl19